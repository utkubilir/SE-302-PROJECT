<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.MenuButton?>
<?import javafx.scene.control.MenuItem?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.control.ProgressBar?>
<?import javafx.scene.control.TitledPane?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.shape.SVGPath?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<StackPane fx:id="rootContainer" prefHeight="800.0" prefWidth="1200.0" stylesheets="@style.css" xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.examplanner.ui.MainController">
   <children>
      <BorderPane>
   
   <!-- Sidebar -->
   <left>
      <VBox fx:id="sidebar" prefWidth="250.0" styleClass="sidebar" BorderPane.alignment="CENTER">
         <children>
            <!-- Header with Logo and Pin Button -->
            <HBox fx:id="sidebarHeader" alignment="CENTER_LEFT" spacing="10" styleClass="sidebar-header">
               <FontIcon fx:id="appLogo" iconLiteral="fas-calendar-check" iconSize="24" styleClass="app-logo"/>
               <Label fx:id="lblAppTitle" styleClass="app-title" text="Exam Planner" HBox.hgrow="ALWAYS"/>
               <Button fx:id="btnPin" mnemonicParsing="false" onAction="#togglePinSidebar" styleClass="pin-button">
                  <graphic><FontIcon fx:id="pinIcon" iconLiteral="fas-thumbtack" iconSize="14" styleClass="pin-icon"/></graphic>
               </Button>
            </HBox>
            
            <!-- Scrollable Navigation Container -->
            <ScrollPane fx:id="navScrollPane" fitToWidth="true" hbarPolicy="NEVER" styleClass="nav-scroll-pane" VBox.vgrow="ALWAYS">
               <content>
                  <StackPane alignment="TOP_LEFT">
                     <Region fx:id="activeIndicator" managed="false" styleClass="active-indicator" visible="false" />
                     <VBox fx:id="navContainer" spacing="5" styleClass="nav-container">
                        <Button fx:id="btnDataImport" maxWidth="Infinity" mnemonicParsing="false" onAction="#showDataImport" styleClass="nav-button, active" text="Data Import">
                           <graphic><FontIcon iconLiteral="fas-file-import" iconSize="16" styleClass="nav-icon"/></graphic>
                        </Button>
                        <Button fx:id="btnDashboard" maxWidth="Infinity" mnemonicParsing="false" onAction="#showDashboard" styleClass="nav-button" text="Dashboard">
                           <graphic><FontIcon iconLiteral="fas-chart-bar" iconSize="16" styleClass="nav-icon"/></graphic>
                        </Button>
                        <Button fx:id="btnTimetable" maxWidth="Infinity" mnemonicParsing="false" onAction="#showTimetable" styleClass="nav-button" text="Timetable">
                           <graphic><FontIcon iconLiteral="fas-calendar-alt" iconSize="16" styleClass="nav-icon"/></graphic>
                        </Button>
                        <Button fx:id="btnStudentSearch" maxWidth="Infinity" mnemonicParsing="false" onAction="#handleSidebarStudentSearch" styleClass="nav-button" text="Student Search">
                           <graphic><FontIcon iconLiteral="fas-user-graduate" iconSize="16" styleClass="nav-icon"/></graphic>
                        </Button>

                     </VBox>
                  </StackPane>
               </content>
            </ScrollPane>
            
            <!-- Bottom Section: Settings, User Profile, Exit -->
            <VBox spacing="5" styleClass="sidebar-footer">
               <Separator styleClass="nav-separator"/>
               
               <!-- User Profile Section -->
               <HBox fx:id="userProfileSection" alignment="CENTER_LEFT" spacing="10" styleClass="user-profile">
                  <FontIcon iconLiteral="fas-user-circle" iconSize="32" styleClass="user-avatar"/>
                  <VBox fx:id="userInfoBox" HBox.hgrow="ALWAYS">
                     <Label fx:id="lblUserName" styleClass="user-name" text="Administrator"/>
                     <Label fx:id="lblUserEmail" styleClass="user-email" text="admin@exam.edu"/>
                  </VBox>
               </HBox>
               
               <Button fx:id="btnHelp" maxWidth="Infinity" mnemonicParsing="false" onAction="#handleHelp" styleClass="nav-button" text="Help">
                  <graphic><FontIcon iconLiteral="fas-question-circle" iconSize="16" styleClass="nav-icon"/></graphic>
               </Button>
               <Button fx:id="btnSettings" maxWidth="Infinity" mnemonicParsing="false" onAction="#handleSettings" styleClass="nav-button" text="Settings">
                  <graphic><FontIcon iconLiteral="fas-cog" iconSize="16" styleClass="nav-icon"/></graphic>
               </Button>
               <Button fx:id="btnExit" maxWidth="Infinity" mnemonicParsing="false" onAction="#handleExit" styleClass="nav-button, exit-button" text="Exit">
                  <graphic><FontIcon iconLiteral="fas-sign-out-alt" iconSize="16" styleClass="nav-icon"/></graphic>
               </Button>
            </VBox>
         </children>
      </VBox>
   </left>

   <!-- Main Content Area -->
   <center>
      <StackPane styleClass="content-area" BorderPane.alignment="CENTER">
         
         <!-- Data Import View -->
         <VBox fx:id="viewDataImport" spacing="20.0">
            <children>
               <VBox>
                  <Label fx:id="lblDataImportTitle" styleClass="section-title" text="Data Import" />
                  <Label fx:id="lblDataImportSubtitle" styleClass="section-subtitle" text="Import required data files to begin" />
               </VBox>

               <VBox spacing="15">
                  <!-- Courses Card -->
                  <HBox styleClass="card" onMouseClicked="#handleLoadCourses" alignment="CENTER_LEFT" spacing="15">
                     <FontIcon iconLiteral="fas-file-alt" iconSize="28" styleClass="card-icon"/>
                     <VBox>
                        <Label fx:id="lblCoursesTitle" styleClass="card-title" text="Courses" />
                        <Label fx:id="lblCoursesStatus" styleClass="card-subtitle" text="courses.csv • Not loaded" />
                     </VBox>
                  </HBox>

                  <!-- Students Card -->
                  <HBox styleClass="card" onMouseClicked="#handleLoadStudents" alignment="CENTER_LEFT" spacing="15">
                     <FontIcon iconLiteral="fas-graduation-cap" iconSize="28" styleClass="card-icon"/>
                     <VBox>
                        <Label fx:id="lblStudentsTitle" styleClass="card-title" text="Students" />
                        <Label fx:id="lblStudentsStatus" styleClass="card-subtitle" text="students.csv • Not loaded" />
                     </VBox>
                  </HBox>

                  <!-- Classrooms Card -->
                  <HBox styleClass="card" onMouseClicked="#handleLoadClassrooms" alignment="CENTER_LEFT" spacing="15">
                     <FontIcon iconLiteral="fas-building" iconSize="28" styleClass="card-icon"/>
                     <VBox>
                        <Label fx:id="lblClassroomsTitle" styleClass="card-title" text="Classrooms" />
                        <Label fx:id="lblClassroomsStatus" styleClass="card-subtitle" text="rooms.csv • Not loaded" />
                     </VBox>
                  </HBox>

                  <!-- Attendance Card -->
                  <HBox styleClass="card" onMouseClicked="#handleLoadAttendance" alignment="CENTER_LEFT" spacing="15">
                     <FontIcon iconLiteral="fas-users" iconSize="28" styleClass="card-icon"/>
                     <VBox>
                        <Label fx:id="lblAttendanceTitle" styleClass="card-title" text="Attendance" />
                        <Label fx:id="lblAttendanceStatus" styleClass="card-subtitle" text="attendance.csv • Not loaded" />
                     </VBox>
                  </HBox>
               </VBox>

               <Region VBox.vgrow="ALWAYS" />

               <VBox fx:id="progressContainer" alignment="CENTER" spacing="8" visible="false" managed="false">
                  <Label fx:id="lblProgressStatus" text="Generating timetable..." style="-fx-font-size: 13px; -fx-text-fill: #6B7280;"/>
                  <ProgressBar fx:id="progressBar" maxWidth="Infinity" prefHeight="20"/>
               </VBox>

               <HBox spacing="10">
                  <Button fx:id="btnDeleteData" maxWidth="Infinity" HBox.hgrow="ALWAYS" mnemonicParsing="false" onAction="#handleDeleteData" styleClass="danger-button" text="Delete All Data" />
                  <Button fx:id="btnGenerateDataImport" maxWidth="Infinity" HBox.hgrow="ALWAYS" mnemonicParsing="false" onAction="#handleGenerateTimetable" styleClass="primary-button" text="Generate Timetable" />
               </HBox>
            </children>
            <padding>
               <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
            </padding>
         </VBox>

         <!-- Timetable View -->
         <VBox fx:id="viewTimetable" spacing="20.0" visible="false">
            <children>
               <HBox alignment="CENTER_LEFT" spacing="20">
                   <Button fx:id="btnTimetableBack" onAction="#showDataImport" styleClass="secondary-button" text="Back">
                      <graphic><FontIcon iconLiteral="fas-arrow-left" iconSize="14" styleClass="btn-icon"/></graphic>
                   </Button>
                  <VBox>
                     <Label fx:id="lblTimetableTitle" styleClass="section-title" text="Exam Schedule" />
                     <Label fx:id="lblTimetableSubtitle" styleClass="section-subtitle" text="December 2025 - Final Exams" />
                  </VBox>
                  <Region HBox.hgrow="ALWAYS" />

                  <ComboBox fx:id="cmbSearchType" visible="false" managed="false" />

                  <!-- Advanced Search Bar -->
                  <HBox alignment="CENTER_LEFT" spacing="0" styleClass="modern-search-bar" prefWidth="350.0">
                     <children>
                        <FontIcon iconLiteral="fas-search" iconSize="14" styleClass="search-icon"/>

                        <TextField fx:id="txtCourseSearch" promptText="Search exams or courses..."
                                   HBox.hgrow="ALWAYS" styleClass="modern-search-field" />

                        <Button fx:id="btnSearchFilter" onAction="#handleFilter" styleClass="modern-filter-btn" mnemonicParsing="false">
                           <graphic>
                              <FontIcon iconLiteral="fas-filter" iconSize="14" styleClass="filter-icon"/>
                           </graphic>
                        </Button>
                     </children>
                  </HBox>
                  
                  <Button fx:id="btnHistory" mnemonicParsing="false" onAction="#showEditHistory" styleClass="secondary-button" text="History">
                     <graphic><FontIcon iconLiteral="fas-history" iconSize="14" styleClass="btn-icon"/></graphic>
                  </Button>
                  <Button fx:id="btnValidateAll" mnemonicParsing="false" onAction="#handleValidateAll" styleClass="secondary-button" text="Validate All">
                     <graphic><FontIcon iconLiteral="fas-check-circle" iconSize="14" styleClass="btn-icon-success"/></graphic>
                  </Button>
                  <Button fx:id="btnConflicts" mnemonicParsing="false" onAction="#handleConflicts" styleClass="secondary-button" text="Conflicts">
                     <graphic><FontIcon iconLiteral="fas-exclamation-triangle" iconSize="14" styleClass="btn-icon-warning"/></graphic>
                  </Button>
                  <MenuButton fx:id="mbExport" styleClass="secondary-button" text="Export">
                     <graphic><FontIcon iconLiteral="fas-download" iconSize="14" styleClass="btn-icon"/></graphic>
                     <items>
                        <MenuItem fx:id="miExportCsv" mnemonicParsing="false" onAction="#handleExportCsv" text="Export to CSV">
                           <graphic><FontIcon iconLiteral="fas-file-csv" iconSize="14" styleClass="btn-icon"/></graphic>
                        </MenuItem>
                        <MenuItem fx:id="miExportPdf" mnemonicParsing="false" onAction="#handleExportPdf" text="Export PDF">
                           <graphic><FontIcon iconLiteral="fas-file-pdf" iconSize="14" styleClass="btn-icon-error"/></graphic>
                        </MenuItem>
                     </items>
                  </MenuButton>
                  <Button fx:id="btnGenerateTimetable" mnemonicParsing="false" onAction="#handleGenerateTimetable" styleClass="primary-button" text="Generate">
                     <graphic><FontIcon iconLiteral="fas-calendar-check" iconSize="14" style="-fx-icon-color: white;"/></graphic>
                  </Button>
               </HBox>
               
               <!-- Tip Box and Schedule Selector Row -->
               <HBox alignment="CENTER_LEFT" spacing="15">
                  <HBox fx:id="tipBox" alignment="CENTER_LEFT" spacing="10" styleClass="tip-box" HBox.hgrow="ALWAYS">
                     <FontIcon iconLiteral="fas-lightbulb" iconSize="16" styleClass="tip-icon"/>
                     <Label fx:id="lblTimetableTip" text="Tip: Double-click a row to edit, or right-click for quick actions." styleClass="tip-text"/>
                  </HBox>
                  
                  <!-- Schedule Selector -->
                  <HBox fx:id="scheduleSelectionBox" alignment="CENTER_LEFT" spacing="8" styleClass="schedule-box" visible="false" managed="false">
                     <FontIcon iconLiteral="fas-calendar-alt" iconSize="14" styleClass="schedule-icon"/>
                     <Label text="Schedule:" styleClass="schedule-label"/>
                     <ComboBox fx:id="cmbScheduleSelector" onAction="#handleScheduleChange" prefWidth="110" styleClass="schedule-selector" />
                  </HBox>
               </HBox>

               <TableView fx:id="examTableView" styleClass="exam-table" VBox.vgrow="ALWAYS">
                  <columns>
                     <TableColumn fx:id="colExamId" text="Exam ID" minWidth="80" maxWidth="100" />
                     <TableColumn fx:id="colCourseCode" text="Course Code" minWidth="140" />
                     <TableColumn fx:id="colDay" text="Date" minWidth="80" maxWidth="100" />
                     <TableColumn fx:id="colTimeSlot" text="Time Slot" minWidth="100" maxWidth="130" />
                     <TableColumn fx:id="colClassroom" text="Classroom" minWidth="140" />
                     <TableColumn fx:id="colStudents" text="Students" minWidth="70" maxWidth="90" />
                     <TableColumn fx:id="colActions" text="Actions" minWidth="80" maxWidth="100" />
                  </columns>
               </TableView>
            </children>
            <padding>
               <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
            </padding>
         </VBox>

         <!-- Dashboard View -->
         <VBox fx:id="viewDashboard" spacing="20.0" visible="false">
             <padding>
                 <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
             </padding>
             <children>
                 <!-- Header with title and actions -->
                 <HBox alignment="CENTER_LEFT" spacing="20">
                     <VBox>
                         <Label fx:id="lblDashboardTitle" styleClass="section-title" text="Analytics Dashboard" />
                         <Label fx:id="lblDashboardSubtitle" styleClass="section-subtitle" text="Schedule Insights" />
                     </VBox>
                     <Region HBox.hgrow="ALWAYS" />
                     <!-- Quick Actions -->
                     <Button fx:id="btnDashboardExport" onAction="#handleExportPdf" styleClass="secondary-button" text="Export Report">
                        <graphic><FontIcon iconLiteral="fas-file-pdf" iconSize="14" styleClass="btn-icon"/></graphic>
                     </Button>
                     <Button fx:id="btnDashboardConflicts" onAction="#handleConflicts" styleClass="secondary-button" text="View Conflicts">
                        <graphic><FontIcon iconLiteral="fas-exclamation-triangle" iconSize="14" styleClass="btn-icon-warning"/></graphic>
                     </Button>
                     <Button fx:id="btnDashboardRegenerate" onAction="#handleGenerateTimetable" styleClass="primary-button" text="Regenerate">
                        <graphic><FontIcon iconLiteral="fas-sync-alt" iconSize="14" style="-fx-icon-color: white;"/></graphic>
                     </Button>
                 </HBox>
                 
                 <!-- Summary Statistics Cards -->
                 <HBox fx:id="statsContainer" spacing="15" styleClass="stats-row">
                     <!-- Total Exams Card -->
                     <VBox fx:id="statCardExams" styleClass="stat-card" HBox.hgrow="ALWAYS" alignment="CENTER">
                         <FontIcon iconLiteral="fas-calendar-check" iconSize="28" styleClass="stat-icon stat-icon-primary"/>
                         <Label fx:id="lblStatExamsValue" styleClass="stat-value" text="0"/>
                         <Label fx:id="lblStatExamsLabel" styleClass="stat-label" text="Total Exams"/>
                     </VBox>
                     <!-- Total Courses Card -->
                     <VBox fx:id="statCardStudents" styleClass="stat-card" HBox.hgrow="ALWAYS" alignment="CENTER">
                         <FontIcon iconLiteral="fas-user-graduate" iconSize="28" styleClass="stat-icon stat-icon-success"/>
                         <Label fx:id="lblStatStudentsValue" styleClass="stat-value" text="0"/>
                         <Label fx:id="lblStatStudentsLabel" styleClass="stat-label" text="Students"/>
                     </VBox>
                     <!-- Total Classrooms Card -->
                     <VBox fx:id="statCardClassrooms" styleClass="stat-card" HBox.hgrow="ALWAYS" alignment="CENTER">
                         <FontIcon iconLiteral="fas-building" iconSize="28" styleClass="stat-icon stat-icon-info"/>
                         <Label fx:id="lblStatClassroomsValue" styleClass="stat-value" text="0"/>
                         <Label fx:id="lblStatClassroomsLabel" styleClass="stat-label" text="Classrooms"/>
                     </VBox>
                     <!-- Exam Days Card -->
                     <VBox fx:id="statCardDays" styleClass="stat-card" HBox.hgrow="ALWAYS" alignment="CENTER">
                         <FontIcon iconLiteral="fas-clock" iconSize="28" styleClass="stat-icon stat-icon-warning"/>
                         <Label fx:id="lblStatDaysValue" styleClass="stat-value" text="0"/>
                         <Label fx:id="lblStatDaysLabel" styleClass="stat-label" text="Exam Days"/>
                     </VBox>
                 </HBox>
                 
                 <!-- Conflict Warning (shown when conflicts exist) -->
                 <HBox fx:id="conflictWarningBox" spacing="15" styleClass="warning-box" visible="false" managed="false" alignment="CENTER_LEFT">
                     <FontIcon iconLiteral="fas-exclamation-triangle" iconSize="20" styleClass="warning-icon"/>
                     <VBox HBox.hgrow="ALWAYS">
                         <Label fx:id="lblConflictTitle" styleClass="warning-title" text="Conflicts Detected"/>
                         <Label fx:id="lblConflictDetails" styleClass="warning-details" text="2 capacity issues, 1 time overlap"/>
                     </VBox>
                     <Button fx:id="btnViewConflicts" onAction="#handleConflicts" styleClass="warning-button" text="View Details"/>
                 </HBox>
                 
                 <!-- Charts Row 1: Exams Per Day + Room Utilization -->
                 <HBox spacing="20" VBox.vgrow="ALWAYS">
                     <VBox styleClass="card" HBox.hgrow="ALWAYS">
                         <Label fx:id="lblExamsPerDay" styleClass="card-title" text="Exams Per Day" />
                         <BarChart fx:id="chartExamsPerDay" VBox.vgrow="ALWAYS">
                             <xAxis>
                                 <CategoryAxis label="Date" />
                             </xAxis>
                             <yAxis>
                                 <NumberAxis label="Count" />
                             </yAxis>
                         </BarChart>
                     </VBox>
                     
                     <VBox styleClass="card" HBox.hgrow="ALWAYS">
                         <Label fx:id="lblRoomUtilization" styleClass="card-title" text="Room Utilization" />
                         <PieChart fx:id="chartRoomUsage" VBox.vgrow="ALWAYS" />
                     </VBox>
                 </HBox>
                 
                 <!-- Charts Row 2: Time Slots + Student Load (optional expansion) -->
                 <HBox fx:id="chartsRow2" spacing="20" VBox.vgrow="ALWAYS">
                     <VBox styleClass="card" HBox.hgrow="ALWAYS">
                         <Label fx:id="lblTimeSlots" styleClass="card-title" text="Time Slot Distribution" />
                         <BarChart fx:id="chartTimeSlots" VBox.vgrow="ALWAYS">
                             <xAxis>
                                 <CategoryAxis label="Time Slot" />
                             </xAxis>
                             <yAxis>
                                 <NumberAxis label="Exams" />
                             </yAxis>
                         </BarChart>
                     </VBox>
                     
                     <VBox styleClass="card" HBox.hgrow="ALWAYS">
                         <Label fx:id="lblStudentLoad" styleClass="card-title" text="Student Workload Distribution" />
                         <BarChart fx:id="chartStudentLoad" VBox.vgrow="ALWAYS">
                             <xAxis>
                                 <CategoryAxis label="Max Daily Exams" />
                             </xAxis>
                             <yAxis>
                                 <NumberAxis label="Student Count" />
                             </yAxis>
                         </BarChart>
                     </VBox>
                 </HBox>
             </children>
         </VBox>
         <!-- user manuel View -->

   <!-- User Manual View -->
   <VBox fx:id="viewUserManual" spacing="20.0" visible="false">
      <padding>
         <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
      </padding>
      <!-- Content injected dynamically by MainController.buildUserManual() -->
   </VBox>


      </StackPane>
   </center>
   
      </BorderPane>
   </children>
</StackPane>
